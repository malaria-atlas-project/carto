<?xml version="1.0"?>
<!DOCTYPE hibernate-mapping PUBLIC
"-//Hibernate/Hibernate Mapping DTD 3.0//EN"
"http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd">
<hibernate-mapping package="uk.ac.ox.map.carto.server">
    <class name="AdminUnit" table="admin">
        <id column="gaul_code" name="id"></id>
		<property name="geom" type="org.hibernatespatial.GeometryUserType">
				<column name="geom" />
		</property>
		<property name="adminLevel">
				<column name="admin_level" />
		</property>
        <property name="name">
				<column name="name" />
        </property>
        
	    <joined-subclass name="AdminUnitRisk" table="px_risk">
	    	<key column="gaul_code"></key>
			<property name="countryId">
					<column name="country_id" />
			</property>
	        <property name="risk">
					<column name="risk" />
	        </property>
	        <property name="api">
					<column name="api" />
	        </property>
	        <property name="parasite">
					<column name="parasite" />
	        </property>
	    </joined-subclass>
    </class>
    <class name="Country" table="api_country">
        <id column="id" name="id"></id>
		<property name="envelope" type="org.hibernatespatial.GeometryUserType">
				<column name="envelope" />
		</property>
        <property name="name">
				<column name="name" />
        </property>
        <property name="hasPf">
				<column name="has_pf" />
        </property>
        <property name="hasPv">
				<column name="has_pv" />
        </property>
    </class>
    <sql-query name="api.years"><![CDATA[
		select year
		from api_by_country
		where country_id = :country_id
		and year is not null
		and parasite = :parasite
		group by year
		order by year
    ]]></sql-query>
    <sql-query name="api.medintelZeroed"><![CDATA[
		select name
		from api_by_country
		where country_id = :country_id
		and medintel_zeroed = true
		and parasite = :parasite
		group by name
		order by name
    ]]></sql-query>
    <sql-query name="api.counts"><![CDATA[
		select cast(count(distinct(gaul_code)) as integer)
		from api_by_country
		where country_id = :country_id
		and parasite = :parasite
    ]]></sql-query>
    <sql-query name="api.admin_level"><![CDATA[
		select 'Admin' || max(admin_level)
		from api_by_country
		where country_id = :country_id
		and parasite = :parasite
    ]]></sql-query>
</hibernate-mapping>